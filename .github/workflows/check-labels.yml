name: Check required labels

on:
  # Trigger on PR creation and label changes (NOT on commits)
  pull_request_target:
    types: [opened, reopened, labeled, unlabeled]
    branches: ["**"]
  # Trigger when checklist comment is edited (user checks boxes)
  issue_comment:
    types: [edited]

# Prevent duplicate runs when swapping labels (unlabeled + labeled events fire together)
concurrency:
  group: check-labels-${{ github.event.pull_request.number || github.event.issue.number }}
  cancel-in-progress: true

jobs:
  check-labels:
    name: Check PR labels
    # Only run on PR events, not comment edits
    if: github.event_name == 'pull_request_target'
    permissions:
      pull-requests: write
    uses: sashacmc/ci/.github/workflows/check-labels.yml@main
    secrets: inherit

  checklist-verification:
    name: PR Checklist Completion
    # Wait for check-labels to finish first (or skip if it didn't run)
    needs: [check-labels]
    # Always run (even if check-labels was skipped due to comment edit)
    if: always()
    permissions:
      pull-requests: write
      statuses: write
    uses: sashacmc/ci/.github/workflows/checklist-verification.yml@main
    secrets: inherit
